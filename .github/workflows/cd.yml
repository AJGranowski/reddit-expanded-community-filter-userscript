# This workflow is used for continuous deployment of applicable builds

name: Continuous Deployment
run-name: "Deploy: ${{ github.event.workflow_run.display_title }}"

on:
  workflow_dispatch:
  workflow_run:
    workflows: [Continuous Integration]
    types: [completed]
    branches: [mainline]

jobs:
  verify:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    name: Verify
    runs-on: ubuntu-latest

    steps:
    - uses: actions/download-artifact@v3
      id: download
      with:
        name: "artifacts"
    - run: echo '${{ github.event.workflow_run.artifacts_url }}'
    - run: ls -R
    - run: echo '${{steps.download.outputs.download-path}}'

  deploy:
    needs: verify
    name: Deploy
    runs-on: ubuntu-latest
    environment: production

    steps:
      - name: Debug print
        run: "echo 'Verification was successful (Nothing deployed)'"

# https://docs.github.com/en/rest/actions/workflow-runs#list-workflow-runs-for-a-workflow